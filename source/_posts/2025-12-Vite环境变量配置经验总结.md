---
title: 2025-12 Viteç¯å¢ƒå˜é‡é…ç½®ç»éªŒæ€»ç»“
date: 2025-12-03 22:07:42
tags: ç»éªŒæ€»ç»“
---

## ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [ç¯å¢ƒå˜é‡æ–‡ä»¶ç³»ç»Ÿ](#ç¯å¢ƒå˜é‡æ–‡ä»¶ç³»ç»Ÿ)
4. [å‘½ä»¤ä¸ç¯å¢ƒå¯¹åº”](#å‘½ä»¤ä¸ç¯å¢ƒå¯¹åº”)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [æ‰©å±•ï¼šå…¶ä»–åŠ è½½æ–¹å¼](#æ‰©å±•å…¶ä»–åŠ è½½æ–¹å¼)

---

## å¿«é€Ÿå¼€å§‹

### ä¸‰æ­¥ä¸Šæ‰‹

**ç¬¬ä¸€æ­¥ï¼šåˆ›å»º `.env` æ–‡ä»¶**

```bash
# .env.development
VITE_API_URL=http://localhost:3000

# .env.production
VITE_API_URL=https://api.example.com
```

**ç¬¬äºŒæ­¥ï¼šåœ¨ä»£ç ä¸­è®¿é—®**

```typescript
// ä»»æ„ .vueã€.tsxã€.js æ–‡ä»¶ä¸­
const apiUrl = import.meta.env.VITE_API_URL;
console.log(apiUrl); // å¼€å‘ç¯å¢ƒè¾“å‡º: http://localhost:3000
```

**ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œé¡¹ç›®**

```bash
npm run dev    # è‡ªåŠ¨åŠ è½½ .env.development
npm run build  # è‡ªåŠ¨åŠ è½½ .env.production
```

### æ ¸å¿ƒè¦ç‚¹

- âœ… å˜é‡åå¿…é¡»ä»¥ `VITE_` å¼€å¤´
- âœ… ä¿®æ”¹ `.env` æ–‡ä»¶åéœ€é‡å¯å¼€å‘æœåŠ¡å™¨
- âœ… ä½¿ç”¨ `import.meta.env.å˜é‡å` è®¿é—®

---

## æ ¸å¿ƒæ¦‚å¿µ

### Vite ç¯å¢ƒå˜é‡çš„å·¥ä½œåŸç†

Vite åœ¨æ„å»ºæ—¶ä¼šè¯»å– `.env` æ–‡ä»¶ï¼Œå¹¶å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ°ä½ çš„åº”ç”¨ä¸­ã€‚

**å…³é”®ç‰¹æ€§ï¼š**

1. **å‰ç¼€é™åˆ¶**ï¼šåªæœ‰ä»¥ `VITE_` å¼€å¤´çš„å˜é‡æ‰ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ä»£ç 
2. **æ„å»ºæ—¶æ³¨å…¥**ï¼šç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶å°±å·²ç»è¢«é™æ€æ›¿æ¢åˆ°ä»£ç ä¸­
3. **æ¨¡å¼é©±åŠ¨**ï¼šé€šè¿‡ `mode` å‚æ•°å†³å®šåŠ è½½å“ªä¸ª `.env.[mode]` æ–‡ä»¶

### ä¸ºä»€ä¹ˆéœ€è¦ `VITE_` å‰ç¼€ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ª**å®‰å…¨æœºåˆ¶**ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“å¯†ç ã€API å¯†é’¥ï¼‰æ„å¤–æš´éœ²åˆ°å®¢æˆ·ç«¯ä»£ç ä¸­ã€‚

```bash
# âœ… ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯
VITE_API_URL=https://api.example.com

# âŒ ä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ï¼ˆä»…åœ¨ vite.config.ts ä¸­å¯ç”¨ï¼‰
DATABASE_PASSWORD=secret123
API_SECRET_KEY=xyz789
```

### ä¸¤ç§è®¿é—®æ–¹å¼

**å®¢æˆ·ç«¯ä»£ç ï¼ˆæµè§ˆå™¨ï¼‰ï¼š**

```typescript
// åªèƒ½è®¿é—® VITE_ å¼€å¤´çš„å˜é‡
const apiUrl = import.meta.env.VITE_API_URL;
const mode = import.meta.env.MODE;
const isDev = import.meta.env.DEV;
```

**é…ç½®æ–‡ä»¶ï¼ˆNode.jsï¼‰ï¼š**

```typescript
// vite.config.ts - å¯ä»¥è®¿é—®æ‰€æœ‰å˜é‡
import { defineConfig, loadEnv } from 'vite';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');
  console.log(env.VITE_API_URL);      // âœ… å¯ä»¥è®¿é—®
  console.log(env.DATABASE_PASSWORD);  // âœ… ä¹Ÿå¯ä»¥è®¿é—®
  return { /* ... */ };
});
```

---

## ç¯å¢ƒå˜é‡æ–‡ä»¶ç³»ç»Ÿ

### æ–‡ä»¶å‘½åè§„åˆ™

Vite æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆæŒ‰ä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š

```
1. .env                    # æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šåŠ è½½ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
2. .env.local              # æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šåŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥
3. .env.[mode]             # åªåœ¨æŒ‡å®š mode æ—¶åŠ è½½
4. .env.[mode].local       # åªåœ¨æŒ‡å®š mode æ—¶åŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
```

### åŠ è½½é¡ºåº

**ååŠ è½½çš„æ–‡ä»¶ä¼šè¦†ç›–å‰é¢åŠ è½½çš„æ–‡ä»¶ä¸­ç›¸åŒçš„å˜é‡**

ç¤ºä¾‹ï¼šè¿è¡Œ `vite --mode development` æ—¶

```
1. .env                    â†’ åŠ è½½ï¼ˆåŸºç¡€é…ç½®ï¼‰
2. .env.local              â†’ åŠ è½½ï¼ˆæœ¬åœ°è¦†ç›–ï¼Œå¦‚æœå­˜åœ¨ï¼‰
3. .env.development        â†’ åŠ è½½ï¼ˆå¼€å‘ç¯å¢ƒé…ç½®ï¼‰
4. .env.development.local  â†’ åŠ è½½ï¼ˆå¼€å‘ç¯å¢ƒæœ¬åœ°è¦†ç›–ï¼Œå¦‚æœå­˜åœ¨ï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼‰
```

### æ–‡ä»¶ä¼˜å…ˆçº§è¡¨

| ä¼˜å…ˆçº§    | æ–‡ä»¶å                | ä½•æ—¶åŠ è½½           | Git çŠ¶æ€ | ç”¨é€”             |
| --------- | --------------------- | ------------------ | -------- | ---------------- |
| 1ï¼ˆæœ€ä½ï¼‰ | `.env`              | æ‰€æœ‰æ¨¡å¼           | é€šå¸¸æäº¤ | å…¬å…±é…ç½®         |
| 2         | `.env.local`        | æ‰€æœ‰æ¨¡å¼           | ä¸æäº¤   | æœ¬åœ°å…¬å…±è¦†ç›–     |
| 3         | `.env.[mode]`       | æŒ‡å®š mode          | é€šå¸¸æäº¤ | ç¯å¢ƒç‰¹å®šé…ç½®     |
| 4ï¼ˆæœ€é«˜ï¼‰ | `.env.[mode].local` | æŒ‡å®š mode          | ä¸æäº¤   | ç¯å¢ƒç‰¹å®šæœ¬åœ°è¦†ç›– |
| -         | `.env.example`      | **ä»ä¸åŠ è½½** | æäº¤     | ä»…ä½œç¤ºä¾‹æ¨¡æ¿     |

### `.env.example` è¯´æ˜

**`.env.example` æ–‡ä»¶ä¸ä¼šè¢« Vite è‡ªåŠ¨è¯»å–**ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç¤ºä¾‹æ¨¡æ¿æ–‡ä»¶ï¼Œç”¨äºï¼š

- å‘Šè¯‰å¼€å‘è€…éœ€è¦é…ç½®å“ªäº›ç¯å¢ƒå˜é‡
- ä½œä¸ºæ–‡æ¡£è¯´æ˜
- é€šå¸¸æäº¤åˆ° Git ä»“åº“
- å¼€å‘è€…å¯ä»¥å¤åˆ¶å®ƒæ¥åˆ›å»ºå®é™…çš„ `.env` æ–‡ä»¶

---

## å‘½ä»¤ä¸ç¯å¢ƒå¯¹åº”

### é»˜è®¤å‘½ä»¤è¡Œä¸º

| å‘½ä»¤             | NODE_ENV        | mode            | è¯»å–çš„ .env æ–‡ä»¶                                                                 |
| ---------------- | --------------- | --------------- | -------------------------------------------------------------------------------- |
| `vite`         | `development` | `development` | `.env` â†’ `.env.local` â†’ `.env.development` â†’ `.env.development.local` |
| `vite build`   | `production`  | `production`  | `.env` â†’ `.env.local` â†’ `.env.production` â†’ `.env.production.local`   |
| `vite preview` | `production`  | `production`  | **ä¸è¯»å–**ï¼ˆä½¿ç”¨æ„å»ºæ—¶çš„å€¼ï¼‰                                               |
| `vitest`       | `test`        | `test`        | `.env` â†’ `.env.local` â†’ `.env.test` â†’ `.env.test.local`               |

### è¡¥å……è¯´æ˜ 1ï¼š`vite preview` ä¸è¯»å–ç¯å¢ƒå˜é‡

**`vite preview` ä¸ä¼šè¯»å–æ–°çš„ `.env` æ–‡ä»¶**ï¼ŒåŸå› ï¼š

- `vite preview` åªæ˜¯é¢„è§ˆå·²ç»æ„å»ºå¥½çš„ `dist` ç›®å½•
- ç¯å¢ƒå˜é‡åœ¨ `vite build` æ—¶å°±å·²ç»æ³¨å…¥åˆ°ä»£ç ä¸­
- `preview` é˜¶æ®µä¸ä¼šé‡æ–°æ„å»ºï¼Œæ‰€ä»¥ä¸ä¼šé‡æ–°è¯»å– `.env`

å¦‚æœéœ€è¦ä¸åŒçš„é¢„è§ˆç¯å¢ƒï¼Œéœ€è¦åœ¨æ„å»ºæ—¶æŒ‡å®šä¸åŒçš„ `--mode`ï¼š

```bash
# æ„å»ºæ—¶ä½¿ç”¨ä¸åŒçš„ mode
vite build --mode staging
vite preview
```

### è¡¥å……è¯´æ˜ 2ï¼šNODE_ENV vs mode

ç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„è¡¨æ ¼ä¸­æœ‰ `NODE_ENV` å’Œ `mode` ä¸¤åˆ—ï¼Œå®ƒä»¬æ˜¯**ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µ**ï¼Œå®¹æ˜“æ··æ·†ï¼š

**`process.env.NODE_ENV`**

- Node.js ç¯å¢ƒå˜é‡ï¼Œæ§åˆ¶æ„å»ºä¼˜åŒ–ï¼ˆä»£ç å‹ç¼©ã€tree-shakingï¼‰
- ç”± Vite æ ¹æ®å‘½ä»¤è‡ªåŠ¨è®¾ç½®ï¼š`vite` â†’ `development`ï¼Œ`vite build` â†’ `production`
- åœ¨ `vite.config.ts` ä¸­é€šè¿‡ `process.env.NODE_ENV` è®¿é—®

**`mode`ï¼ˆæ¨¡å¼ï¼‰**

- Vite çš„æ¨¡å¼å‚æ•°ï¼Œå†³å®šåŠ è½½å“ªä¸ª `.env.[mode]` æ–‡ä»¶
- å¯ä»¥æ˜¯ä»»æ„è‡ªå®šä¹‰å€¼ï¼ˆå¦‚ `staging`ã€`test`ï¼‰
- é€šè¿‡ `--mode` å‚æ•°æŒ‡å®šï¼Œåœ¨å®¢æˆ·ç«¯é€šè¿‡ `import.meta.env.MODE` è®¿é—®

**å…³é”®åŒºåˆ«ï¼š**

| å‘½ä»¤                          | NODE_ENV        | mode            | è¯´æ˜                    |
| ----------------------------- | --------------- | --------------- | ----------------------- |
| `vite`                      | `development` | `development` | é»˜è®¤ç›¸åŒ                |
| `vite build`                | `production`  | `production`  | é»˜è®¤ç›¸åŒ                |
| `vite build --mode staging` | `production`  | `staging`     | **å¯ä»¥ä¸åŒ** âš ï¸ |
| `NODE_ENV=test vite build`  | `test`        | `production`  | **å¯ä»¥ä¸åŒ** âš ï¸ |

ğŸ’¡ **æ¨èåšæ³•**ï¼šåœ¨ Vite é¡¹ç›®ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨ `import.meta.env.MODE` æ¥åˆ¤æ–­ç¯å¢ƒï¼Œè€Œä¸æ˜¯ä¾èµ– `process.env.NODE_ENV`ã€‚

---

## æœ€ä½³å®è·µ

### 1. å®Œæ•´çš„æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ .env                    # æ‰€æœ‰ç¯å¢ƒçš„å…¬å…±é…ç½®ï¼ˆæäº¤ï¼‰
â”œâ”€â”€ .env.development        # å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆæäº¤ï¼‰
â”œâ”€â”€ .env.production         # ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæäº¤ï¼‰
â”œâ”€â”€ .env.local             # æœ¬åœ°è¦†ç›–é…ç½®ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example           # ç¤ºä¾‹æ¨¡æ¿ï¼ˆæäº¤ï¼‰
â””â”€â”€ .gitignore             # æ·»åŠ  .env*.local
```

**ç¤ºä¾‹å†…å®¹ï¼š**

```bash
# .env - å…¬å…±é…ç½®
VITE_APP_NAME=My App

# .env.development
VITE_API_URL=http://localhost:3000
VITE_DEBUG=true

# .env.production
VITE_API_URL=https://api.example.com
VITE_DEBUG=false

# .env.example - ç¤ºä¾‹æ¨¡æ¿
VITE_API_URL=
VITE_APP_NAME=
```

### 2. å‘½åè§„èŒƒ

```bash
# âœ… æ­£ç¡®å†™æ³•
VITE_API_BASE_URL=https://api.example.com
VITE_APP_TITLE=My App
VITE_ENABLE_MOCK=true

# âŒ é”™è¯¯å†™æ³•ï¼ˆå®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼‰
API_BASE_URL=https://api.example.com
appTitle=My App
```

**è§„åˆ™ï¼š**

- å¿…é¡»ä»¥ `VITE_` å¼€å¤´
- ä½¿ç”¨å…¨å¤§å†™å­—æ¯
- å•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”

### 3. å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨

```typescript
// è®¿é—®ç¯å¢ƒå˜é‡
const apiUrl = import.meta.env.VITE_API_URL;

// å†…ç½®å˜é‡
const mode = import.meta.env.MODE;       // å½“å‰æ¨¡å¼
const isDev = import.meta.env.DEV;       // æ˜¯å¦å¼€å‘ç¯å¢ƒ
const isProd = import.meta.env.PROD;     // æ˜¯å¦ç”Ÿäº§ç¯å¢ƒ
const baseUrl = import.meta.env.BASE_URL; // å…¬å…±åŸºç¡€è·¯å¾„

// å¸¦é»˜è®¤å€¼
const debug = import.meta.env.VITE_DEBUG || 'false';
```

### 4. åœ¨ vite.config.ts ä¸­ä½¿ç”¨

```typescript
import { defineConfig, loadEnv } from 'vite';

export default defineConfig(({ mode }) => {
  // åŠ è½½ç¯å¢ƒå˜é‡
  const env = loadEnv(mode, process.cwd(), '');
  
  return {
    // æ–¹å¼1: ä½¿ç”¨ define æ³¨å…¥å…¨å±€å¸¸é‡
    define: {
      __APP_VERSION__: JSON.stringify('1.0.0'),
      __API_URL__: JSON.stringify(env.VITE_API_URL),
    },
  
    // æ–¹å¼2: æ ¹æ®ç¯å¢ƒå˜é‡é…ç½®æ’ä»¶
    server: {
      port: Number(env.VITE_PORT) || 3000,
      proxy: env.VITE_API_URL ? {
        '/api': {
          target: env.VITE_API_URL,
          changeOrigin: true,
        }
      } : undefined,
    },
  };
});
```

### 5. TypeScript ç±»å‹æ”¯æŒ

åˆ›å»º `env.d.ts` ä¸ºç¯å¢ƒå˜é‡æ·»åŠ ç±»å‹ï¼š

```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_URL: string;
  readonly VITE_APP_NAME: string;
  readonly VITE_DEBUG: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

---

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæˆ‘çš„ç¯å¢ƒå˜é‡åœ¨å®¢æˆ·ç«¯è®¿é—®ä¸åˆ°ï¼Ÿ**
A: ç¡®ä¿å˜é‡åä»¥ `VITE_` å¼€å¤´ï¼Œå¹¶ä¸”é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚

**Q: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Ÿ**
A: åˆ›å»º `.env.development`ã€`.env.production` ç­‰æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ `--mode` å‚æ•°ã€‚

**Q: `vite preview` èƒ½è¯»å–æ–°çš„ç¯å¢ƒå˜é‡å—ï¼Ÿ**
A: ä¸èƒ½ï¼Œç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶å°±å·²ç»æ³¨å…¥ï¼Œéœ€è¦é‡æ–°æ„å»ºæ‰èƒ½æ›´æ–°ã€‚

**Q: `.env.example` ä¼šè¢« Vite åŠ è½½å—ï¼Ÿ**
A: ä¸ä¼šï¼Œå®ƒåªæ˜¯ç¤ºä¾‹æ¨¡æ¿ï¼Œéœ€è¦å¤åˆ¶ä¸ºå®é™…çš„ `.env` æ–‡ä»¶ã€‚

---

## æ‰©å±•ï¼šå…¶ä»–åŠ è½½æ–¹å¼

åœ¨é Vite é¡¹ç›®æˆ– Node.js è„šæœ¬ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å…¶ä»–æ–¹å¼åŠ è½½ç¯å¢ƒå˜é‡ã€‚

### æ–¹å¼å¯¹æ¯”

| æ–¹å¼                   | é€‚ç”¨åœºæ™¯        | ä½¿ç”¨æ–¹æ³•                        | è¯´æ˜               |
| ---------------------- | --------------- | ------------------------------- | ------------------ |
| **Vite å†…ç½®**    | Vite é¡¹ç›®       | è‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€é…ç½®              | âœ… æ¨è            |
| **dotenv åº“**    | Node.js è„šæœ¬    | `require('dotenv').config()`  | éœ€è¦å®‰è£…ä¾èµ–       |
| **Node.js åŸç”Ÿ** | Node.js 20.6+   | `node --env-file=.env app.js` | æ— éœ€ä¾èµ–ï¼ŒåŸç”Ÿæ”¯æŒ |
| **tsx**          | TypeScript æ–‡ä»¶ | `tsx --env-file=.env app.ts`  | ç›´æ¥è¿è¡Œ .ts æ–‡ä»¶  |

### dotenv åº“ä½¿ç”¨

```bash
npm install dotenv
```

```typescript
// åŸºæœ¬ç”¨æ³•
import dotenv from 'dotenv';
dotenv.config();

// æŒ‡å®šæ–‡ä»¶
dotenv.config({ path: '.env.development' });

// è®¿é—®å˜é‡
console.log(process.env.DB_HOST);
```

### Node.js åŸç”Ÿæ”¯æŒï¼ˆ20.6+ï¼‰

```bash
# å‘½ä»¤è¡Œä½¿ç”¨
node --env-file=.env app.js

# package.json
{
  "scripts": {
    "dev": "node --env-file=.env.development src/index.js"
  }
}
```

### TypeScript ç±»å‹å£°æ˜

```typescript
// env.d.ts
declare global {
  namespace NodeJS {
    interface ProcessEnv {
      DB_HOST: string;
      API_KEY: string;
    }
  }
}

export {};
```

---

**é€‚ç”¨ç‰ˆæœ¬**ï¼šVite 5.x+, Node.js 20.6+
